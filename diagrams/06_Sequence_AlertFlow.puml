@startuml Sequence Diagram - Alert Detection and Notification Flow
!theme plain
skinparam sequenceArrowThickness 2
skinparam roundcorner 10

actor Administrator as Admin
participant "Orange Pi\nMonitoring" as OrangePi
participant "alerts.json\nFile" as File
participant "Alert Monitor\nService" as Monitor
participant "WebSocket\nManager" as WS
participant "Push Notification\nService" as Push
participant "Frontend\nDashboard" as Frontend
database "MongoDB" as DB

== Alert Detection ==
OrangePi -> OrangePi: Detect anomaly in traffic
OrangePi -> File: Write new alert to alerts.json
activate File

== File Monitoring ==
Monitor -> File: Check file modification (every 2s)
File --> Monitor: File modified
Monitor -> File: Read alerts.json
File --> Monitor: Return alert data
deactivate File

Monitor -> Monitor: Compare alert IDs
Monitor -> Monitor: Identify new alerts

== WebSocket Notification ==
Monitor -> WS: Send alert data
activate WS
WS -> Frontend: Broadcast to /ws/alerts channel
activate Frontend
Frontend -> Frontend: Display alert popup
Frontend -> Frontend: Show browser notification
Frontend -> Frontend: Update alerts list
Frontend -> Frontend: Show toast notification
deactivate Frontend
deactivate WS

== Push Notification ==
Monitor -> Push: Send alert for push notification
activate Push
Push -> DB: Get active subscriptions
activate DB
DB --> Push: Return subscriptions list
deactivate DB

loop For each subscription
    Push -> Push: Send push notification
    Push -> Push: Update last_used timestamp
end

deactivate Push

== User Interaction ==
Admin -> Frontend: Views alert in dashboard
Frontend -> Admin: Display alert details
Admin -> Frontend: Clicks "Acknowledge"
Frontend -> Frontend: Send PATCH /api/alerts/{id}/acknowledge
Frontend -> DB: Update alert acknowledged = true
activate DB
DB --> Frontend: Confirmation
deactivate DB
Frontend -> Admin: Alert marked as acknowledged

@enduml

