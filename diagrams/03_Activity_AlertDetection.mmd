```mermaid
flowchart TD
    Start([Orange Pi detects anomaly]) --> Write[Write alert to alerts.json]
    Write --> Monitor[Alert Monitor checks file every 2s]
    Monitor --> Read[Read alerts.json]
    Read --> Compare[Compare alert IDs with tracked IDs]
    
    Compare --> CheckNew{New alerts found?}
    CheckNew -->|No| Continue[Continue monitoring]
    Continue --> Monitor
    
    CheckNew -->|Yes| Extract[Extract alert data]
    Extract --> FormatWS[Format for WebSocket]
    FormatWS --> SendWS[Send to WebSocket Manager]
    SendWS --> Broadcast[Broadcast to /ws/alerts channel]
    
    Broadcast --> CheckWS{Clients connected?}
    CheckWS -->|Yes| ReceiveWS[Frontend receives message]
    ReceiveWS --> Popup[Display alert popup]
    Popup --> BrowserNotif[Show browser notification]
    BrowserNotif --> UpdateList[Update alerts list]
    UpdateList --> Toast[Show toast notification]
    CheckWS -->|No| NoWS[No WebSocket delivery]
    
    Extract --> FormatPush[Format for Push Notification]
    FormatPush --> SendPush[Send to Push Service]
    SendPush --> GetSubs[Get active subscriptions from MongoDB]
    
    GetSubs --> CheckSubs{Subscriptions exist?}
    CheckSubs -->|No| NoPush[No push delivery]
    CheckSubs -->|Yes| SendEach[Send to each subscription]
    
    SendEach --> CheckSent{Sent successfully?}
    CheckSent -->|Yes| UpdateSub[Update last_used]
    CheckSent -->|No| MarkInactive[Mark subscription inactive]
    
    UpdateSub --> UpdateIDs[Update tracked alert IDs]
    MarkInactive --> UpdateIDs
    Toast --> UpdateIDs
    NoWS --> UpdateIDs
    NoPush --> UpdateIDs
    UpdateIDs --> Monitor
    
    style Start fill:#FFF3E0,stroke:#FF9800
    style Extract fill:#FFE0B2,stroke:#FF9800
    style Broadcast fill:#FFE0B2,stroke:#FF9800
    style SendEach fill:#FFE0B2,stroke:#FF9800
    style CheckNew fill:#FFF9C4,stroke:#FBC02D
    style CheckWS fill:#FFF9C4,stroke:#FBC02D
    style CheckSubs fill:#FFF9C4,stroke:#FBC02D
    style CheckSent fill:#FFF9C4,stroke:#FBC02D

```

