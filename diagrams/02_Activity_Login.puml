@startuml Activity Diagram - Login Process
!theme plain
skinparam activity {
  BackgroundColor #E8F4F8
  BorderColor #2E5C8A
  FontColor #000
}

start

:Administrator navigates
to login page;

:Administrator enters
email and password;

:Administrator clicks
"Login" button;

:Frontend sends POST /api/auth/login
with credentials;

:Backend receives login request;

:Backend queries MongoDB
for user by email;

if (User exists in database?) then (No)
  :Return 401 Unauthorized
  "Incorrect email or password";
  :Frontend displays error message;
  stop
else (Yes)
endif

:Backend verifies password
using bcrypt hash comparison;

if (Password matches hash?) then (No)
  :Return 401 Unauthorized
  "Incorrect email or password";
  :Frontend displays error message;
  stop
else (Yes)
endif

:Backend updates last_login
timestamp in database;

:Backend validates user role
(Administrator only);

if (User role is Admin?) then (No)
  :Return 403 Forbidden
  "Administrator access only";
  :Frontend displays error message;
  stop
else (Yes - Admin)
endif

:Backend creates JWT access token
with email and admin role
(30 min expiry);

:Backend creates JWT refresh token
with email (7 day expiry);

:Backend returns tokens to frontend
{access_token, refresh_token, token_type};

:Frontend stores tokens in
Zustand store with persistence
(localStorage);

:Frontend calls GET /api/auth/me
with Bearer token to get profile;

:Backend validates token and
returns user profile;

:Frontend stores user profile
in Zustand state;

:Frontend redirects to Dashboard;

:Administrator sees dashboard with
device list, statistics, and
real-time monitoring;

stop

@enduml

